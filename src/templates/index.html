<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DPIA ¬∑ Chat Contextual (MVP UI)</title>

  <!-- Libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- CSS base -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/chatIdentidades.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/chatAmbitos.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/chatMensajes.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/mydomain/mydomain.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/indexChat.css') }}">

  <!-- (si segu√≠s usando el buscador viejo) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/busquedas/busquedaAmbitos.css') }}">
  <!-- üîé NUEVO -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chats/busquedas/busquedaSelectiva.css') }}">
</head>
<body>
  <!-- NAVBAR -->
  <div class="nav">
    <div class="brand"><span class="dot"></span><span>DPIA ¬∑ Chat Contextual</span></div>
    <div style="display:flex; gap:8px; align-items:center">
      <button id="btnMyDomain" class="btn">My domain</button>
      <button id="toggleTheme" class="btn">‚òÄÔ∏è Claro / üåô Oscuro</button>
    </div>
  </div>

  <!-- GRID 3-3-6 -->
  <div class="wrap">
    <div class="app-grid">
      <aside id="col-identidades" class="col-identidades">
        {% include 'chats/chatIdentidades.html' %}
      </aside>
      <section id="col-ambitos" class="col-ambitos">
        {% include 'chats/chatAmbitos.html' %}
      </section>
      <section id="col-chat" class="col-chat">
        {% include 'chats/chatMensajes.html' %}
      </section>
    </div>
  </div>

  <!-- Overlay MyDomain (donde adentro vas a incluir busquedaSelectiva.html) -->
  {% include 'chats/mydomain/chatDominios.html' %}

  <!-- JS m√≥dulos -->
  <script src="{{ url_for('static', filename='js/chats/indexChat.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/mydomain/mydomain.js') }}" defer></script>

  <!-- üîé NUEVO buscador selectivo -->
  <script src="{{ url_for('static', filename='js/chats/busquedas/busquedaSelectiva.js') }}" defer></script>

  <!-- Init del buscador selectivo -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Asegurate de haber incluido en chatDominios.html:
      // {% include 'chats/busquedas/busquedaSelectiva.html' %} dentro de .md-filters
      window.busquedaSelectivaInit?.({
        sel: {
          inputLoc:   '#hub-loc',
          suggestLoc: '#hub-loc-suggest',
          inputQ:     '#hub-q',
          btnGo:      '#hub-go',
          boxDomains: '#hub-domains',
          boxCats:    '#hub-cats'
        },
        render: {
          loading: (msg) => mdRightLoading(msg || 'Buscando‚Ä¶'),
          results: (items) => renderResultadosEnPanelDerecho(items || [])
        },
        api: {
          sugerir:  (q)=> `/api/ubicacion/sugerir?q=${encodeURIComponent(q)}`,
          resolver: (q)=> `/api/ubicacion/resolver?q=${encodeURIComponent(q)}`,
          dominios: (loc)=> `/api/domains?${loc.type==='cp' ? 'cp='+loc.id : 'city_id='+loc.id}`,
          categorias: (dom,loc)=> `/api/categories?domain_id=${dom.id}&${loc.type==='cp' ? 'cp='+loc.id : 'city_id='+loc.id}`,
          publicaciones: (dom,cat,loc,q)=>{
            const qs = new URLSearchParams({
              domain_id: dom?.id || '',
              category_id: cat?.id || '',
              q: q || '',
              [loc.type==='cp' ? 'cp' : 'city_id']: loc.id
            });
            return `/api/publicaciones?${qs.toString()}`;
          }
        }
      });
    });
  </script>
</body>
</html>
